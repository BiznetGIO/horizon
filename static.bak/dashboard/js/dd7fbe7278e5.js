(function(){"use strict";angular.module('horizon.app.core.images').factory('horizon.app.core.images.service',imageService);imageService.$inject=['$filter','$location','horizon.app.core.openstack-service-api.glance','horizon.app.core.openstack-service-api.userSession','horizon.app.core.images.transitional-statuses','horizon.app.core.openstack-service-api.settings','horizon.app.core.detailRoute'];function imageService($filter,$location,glance,userSession,transitionalStatuses,settings,detailRoute){var version;return{getDetailsPath:getDetailsPath,getImagePromise:getImagePromise,getImagesPromise:getImagesPromise,imageType:imageType,isInTransition:isInTransition,getFilterFirstSettingPromise:getFilterFirstSettingPromise};function getDetailsPath(item){return detailRoute+'OS::Glance::Image/'+item.id;}
function imageType(item){if(null!==item&&angular.isDefined(item)&&angular.isDefined(item.properties)&&item.properties.image_type==='snapshot'){return gettext('Snapshot');}else{return gettext('Image');}}
function isInTransition(item){if(item&&angular.isString(item.status)){return transitionalStatuses.indexOf(item.status.toLowerCase())>-1;}
return false;}
function getImagesPromise(params){var projectId;return userSession.get().then(getImages);function getImages(userSession){glance.getVersion().then(setVersion);projectId=userSession.project_id;return glance.getImages(params).then(modifyResponse);}
function modifyResponse(response){return{data:{items:response.data.items.map(modifyImage)}};function modifyImage(image){image.trackBy=image.id+image.updated_at;image.apiVersion=version;image.visibility=$filter('imageVisibility')(image,projectId);image.name=image.name||image.id;return image;}}}
function getImagePromise(identifier){glance.getVersion().then(setVersion);return glance.getImage(identifier).then(modifyResponse);function modifyResponse(response){response.data.apiVersion=version;return{data:response.data};}}
function setVersion(response){version=response.data.version;}
function getFilterFirstSettingPromise(){return settings.getSetting('FILTER_DATA_FIRST',{'admin.images':false}).then(resolve);function resolve(result){if($location.url()==='/admin/images'){return result['admin.images'];}
return false;}}}})();